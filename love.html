<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üíñ A Question For You üíñ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;height:100vh;
  background:linear-gradient(135deg,#ff9a9e,#fad0c4);
  display:flex;justify-content:center;align-items:center;
  font-family:'Comic Sans MS',cursive;
  overflow:hidden;
  transition:transform .1s ease;
}

.box{
  background:#fff;padding:25px;border-radius:20px;
  text-align:center;width:90%;max-width:350px;
  box-shadow:0 10px 25px rgba(0,0,0,.2);
  z-index:2;
}

button{
  padding:10px 20px;margin:10px;border:none;
  border-radius:10px;font-size:16px;
  cursor:pointer;transition:transform .2s ease;
}

#yes{background:#ff4d6d;color:#fff;}
#no{background:#ccc;position:absolute;}

/* üé≠ NO MESSAGE MODES */
#noMsg{
  margin-top:10px;
  transition:all .3s ease;
}

/* Lovely */
.mode-love{
  font-family:'Comic Sans MS',cursive;
  color:#ff5c8a;
  font-size:14px;
}

/* Little angry */
.mode-angry{
  font-family:Arial,sans-serif;
  color:#ff9800;
  font-weight:bold;
}

/* Angry */
.mode-angrier{
  font-family:Arial,sans-serif;
  color:#ff3b3b;
  font-weight:800;
}

/* Too angry */
.mode-rage{
  font-family:Arial Black,sans-serif;
  color:#b00020;
  font-style:italic;
  font-size:16px;
}

/* Fireworks */
.firework{
  position:fixed;width:6px;height:6px;border-radius:50%;
  animation:explode 1s ease-out forwards;
}
@keyframes explode{
  from{transform:scale(1);opacity:1;}
  to{transform:scale(15);opacity:0;}
}
</style>
</head>

<body>

<audio id="bgMusic" loop preload="auto"></audio>
<audio id="noSound" src="assets/no_sound.mp3" preload="auto"></audio>

<div class="box" id="mainBox">
  <h2 id="msg"></h2>

  <!-- üé≠ NO MESSAGE -->
  <p id="noMsg" class="mode-love">
    sonna kelu "NO" thodathe üòÅ
  </p>

  <img src="assets/heart.gif" width="120"><br><br>

  <button id="yes">YES üíñ</button>
  <button id="no">NO üòú</button>
</div>

<script>
/* URL PARAMS */
const params=new URLSearchParams(location.search);
const partner=decodeURIComponent(escape(atob(params.get("y")||"")));
const genderCombo=(params.get("g")||"").toLowerCase().trim();

/* ELEMENTS */
const music=document.getElementById("bgMusic");
const yesBtn=document.getElementById("yes");
const noBtn=document.getElementById("no");
const noMsg=document.getElementById("noMsg");
const noSound=document.getElementById("noSound");

/* MUSIC */
if(genderCombo==="mf")music.src="assets/love_1.mp3";
else if(genderCombo==="fm")music.src="assets/love_2.mp3";
else music.src="assets/love_1.mp3";

/* QUESTION */
document.getElementById("msg").innerHTML=
`Hai ${partner} üíï<br>Will you be my Valentine?`;

/* NO BUTTON LOGIC */
let yesScale=1,noCount=0;

function evadeNo(){
  noBtn.style.left=Math.random()*80+"%";
  noBtn.style.top=Math.random()*80+"%";

  yesScale+=.2;
  yesBtn.style.transform=`scale(${yesScale})`;

  if(navigator.vibrate)navigator.vibrate(80);

  document.body.style.transform="translateX(10px)";
  setTimeout(()=>document.body.style.transform="translateX(-10px)",50);
  setTimeout(()=>document.body.style.transform="translateX(0)",100);

  noSound.currentTime=0;
  noSound.play();

  noCount++;

  if(noCount===1){
    noMsg.className="mode-angry";
    noMsg.innerText="sonna kekke matiyaa üò†!!!!...";
  }
  else if(noCount===2){
    noMsg.className="mode-angrier";
    noMsg.innerText="last warning no ah thodathe üò°!!!!...";
  }
  else if(noCount===3){
    noMsg.className="mode-rage";
    noMsg.innerText="sonna kekka matta ipo paaru üòè!!!!...";
    setTimeout(()=>noBtn.style.display="none",2000);
  }
}

noBtn.addEventListener("mouseover",evadeNo);
noBtn.addEventListener("touchstart",evadeNo);

/* YES */
yesBtn.addEventListener("click",()=>{
  if(navigator.vibrate)navigator.vibrate([200,100,200,100,300]);
  music.volume=.35;
  music.play().catch(()=>{});

  document.getElementById("mainBox").innerHTML=`
    <h1>YAY üòç</h1>
    <p id="typeText"></p>
    <img src="assets/love.png" width="200">
  `;
  typeWriter("Best decision ever üíñ I love you endlessly üòò");
  fireworks();
});

/* TYPEWRITER */
function typeWriter(text){
  let i=0,t=document.getElementById("typeText");
  (function typing(){
    if(i<text.length){
      t.innerHTML+=text.charAt(i++);
      setTimeout(typing,60);
    }
  })();
}

/* FIREWORKS */
function fireworks(){
  setInterval(()=>{
    const f=document.createElement("div");
    f.className="firework";
    f.style.left=Math.random()*100+"%";
    f.style.top=Math.random()*100+"%";
    f.style.background=`hsl(${Math.random()*360},100%,60%)`;
    document.body.appendChild(f);
    setTimeout(()=>f.remove(),1000);
  },200);
}
</script>

</body>
</html>
